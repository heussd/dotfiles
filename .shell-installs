# https://stackoverflow.com/questions/19151510/get-the-number-of-days-since-file-is-last-modified
since_last_modified() {
   local modified
   local now=$(date +%s)
   local period=$2

   stat -f %m $1 > /dev/null 2>&1 && modified=$(stat -f %m $1) # BSD stat
   stat -c %Y $1 > /dev/null 2>&1 && modified=$(stat -c %Y $1) # GNU stat

   case $period in
        day|days)    period=86400 ;; # 1 day in seconds
       hour|hours)   period=1440  ;; # 1 hour in seconds
     minute|minutes) period=60    ;; # 1 minute in seconds
           *)        period=      ;; # default to seconds
   esac

   if [[ $period > 0 ]]; then
      echo "$(( (now - modified) / period ))"
   else
      echo "$(( now - modified ))"
   fi
}


_hasFolder $HOME/.dotfiles-bare-repo && _hasCmd dotfiles && (
   if [ $(since_last_modified .dotfiles-bare-repo/FETCH_HEAD days) -ge 7 ]; then
         dotfiles pull
   fi
)

_hasCmd brew && (
   lastinstall=$(since_last_modified .brewfile-install days)
   brewfile=$(since_last_modified ~/.Brewfile days)

   if [[ $lastinstall -gt 30 ]] || [[ $brewfile -lt $lastinstall ]]; then
      make homebrew && touch ~/.brewfile-install
   fi
)

_hasCmd thefuck && eval "$(thefuck --alias)"

echo $SHELL | grep "bash" > /dev/null && _hasFile ~/.fzf.bash && source ~/.fzf.bash
echo $SHELL | grep "zsh" > /dev/null && _hasFile ~/.fzf.zsh && source ~/.fzf.zsh

